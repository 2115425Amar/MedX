<!-- app/views/shared/_nav_and_sidebar.html.erb -->

<!-- NAVBAR -->
<nav class="fixed top-0 w-full md:w-[84%] z-40 bg-white shadow-md">
  <div class="flex justify-center md:py-2 mx-4">
    <div class="flex w-full md:px-6 justify-between items-center">
      <!-- Sidebar Toggle Button -->
      <button id="sidebarToggle" class="ml-2 p-4 mr-4 py-1 z-50 bg-blue-500 text-white rounded md:hidden">
        ☰
      </button>

      <!-- Search Bar -->
      <div class="flex md:gap-2 p-2 md:p-3 items-center w-[80%] border-2 border-[#3333334D] rounded-2xl">
        <img src="<%= asset_path('search.svg') %>" class="w-4 md:w-6" alt="icon">
        <input
          class="md:text-lg font-['Montserrat'] text-sm md:font-semibold text-gray-600 focus:outline-none w-1/2 md:w-full"
          placeholder="Search for something here..."
        >
      </div>

      <!-- User Info -->
      <%= link_to profile_path, class: "flex gap-0 md:gap-4 p-2 items-center md:border-2 border-[#3333334D] rounded-2xl ml-2 hover:bg-gray-100 transition-colors" do %>
        <div class="flex flex-col">
          <% if current_user %>
            <h2 class="text-sm md:text-lg mb-1">
              <%= current_user.first_name %> <%= current_user.last_name %>
            </h2>
            <% if current_user.has_role?(:admin) %>
              <div class="text-[8%] md:text-sm hidden md:block">Receptionist</div>
            <% elsif current_user.has_role?(:doctor) %>
              <div class="text-[8%] md:text-sm hidden md:block">Doctor</div>
            <% else %>
              <div class="text-[8%] md:text-sm hidden md:block">Patient</div>
            <% end %>
          <% end %>
        </div>
        <%= image_tag current_user.avatar_url, class: "w-6 h-6 md:w-10 md:h-10 rounded-full" %>
      <% end %>
    </div>
  </div>
  <hr class="w-full">
</nav>

<!-- SIDEBAR -->
<div id="sidebar"
     class="fixed left-0 top-0 w-64 h-full bg-gray-800 text-white transform -translate-x-full transition-transform duration-300">
  <div class="p-4">
    <!-- Logo -->
    <%= link_to profile_path, class: "flex items-center gap-4 mb-6" do %>
      <img src="<%= asset_path('Vector.svg') %>" class="w-8 md:w-10" alt="icon">
      <span class="text-2xl md:text-4xl font-serif font-semibold">MedX</span>
    <% end %>

    <!-- Menu Items -->
    <ul class="mt-5 space-y-2 font-medium">
      <% if current_user&.doctor? %>
        <li>
          <%= link_to dashboard_path, class: "flex items-center p-4 text-black bg-white rounded-lg hover:bg-[#377DFF] hover:text-white group" do %>
            <!-- dashboard icon… -->
            <span class="flex-1 ms-3">Dashboard</span>
          <% end %>
        </li>
        <li>
          <%= link_to manage_users_path, class: "flex items-center p-4 text-black bg-white rounded-lg hover:bg-[#377DFF] hover:text-white group" do %>
            <!-- manage icon… -->
            <span class="flex-1 ms-3">Manage Account</span>
          <% end %>
        </li>
      <% end %>

      <% if current_user&.admin? %>
        <li>
          <%= link_to manage_users_path, class: "flex items-center p-4 text-black bg-white rounded-lg hover:bg-[#377DFF] hover:text-white group" do %>
            <span class="flex-1 ms-3">Manage Account</span>
          <% end %>
        </li>
        <li>
          <%= link_to reports_path, class: "flex items-center p-4 text-black bg-white rounded-lg hover:bg-[#377DFF] hover:text-white group" do %>
            <img src="<%= asset_path('report.svg') %>" class="w-5 h-5 shrink-0" alt="icon">
            <span class="flex-1 ms-3">Reports</span>
          <% end %>
        </li>
      <% end %>

      <li>
        <%= link_to profile_path, class: "flex items-center p-4 text-black bg-white rounded-lg hover:bg-[#377DFF] hover:text-white group" do %>
          <span class="flex-1 ms-3">Profile</span>
        <% end %>
      </li>
      <li>
        <%= link_to posts_path, class: "flex items-center p-4 text-black bg-white rounded-lg hover:bg-[#377DFF] hover:text-white group" do %>
          <span class="flex-1 ms-3">Feed</span>
        <% end %>
      </li>
      <li>
        <%= link_to destroy_user_session_path, method: :delete, class: "flex items-center p-4 text-black bg-white rounded-lg hover:bg-[#377DFF] hover:text-white group" do %>
          <span class="flex-1 ms-3">Log Out</span>
        <% end %>
      </li>
    </ul>
  </div>
</div>

<!-- TOGGLE SCRIPT -->
<script>
  document.addEventListener("DOMContentLoaded", function() {
    const sidebar = document.getElementById("sidebar");
    const toggleBtn = document.getElementById("sidebarToggle");

    if (toggleBtn && sidebar) {
      toggleBtn.addEventListener("click", function() {
        sidebar.classList.toggle("-translate-x-full");
      });
    }
  });
</script>
